<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CNCT - Personalized Learning</title>
    <style>
      :root {
        --primary-color: #4CAF90;  /* Mint Green */
        --accent-color: #81C784;  /* Lighter Mint */
        --bg-gradient: linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%);
        --text-color: #2E7D32;    /* Dark Green */
        --card-bg: rgba(255, 255, 255, 0.95);
        --shadow: 0 4px 6px rgba(76, 175, 144, 0.1);
        --hover-color: #66BB6A;   /* Bright Mint */
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .title {
        text-align: center;
        padding: 2rem 0;
        width: 100%;
        background: var(--card-bg);
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        position: relative;
        z-index: 1;
      }

      .title h1 {
        font-size: 3.5rem;
        margin: 0;
        background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
      }

      .title p {
        font-size: 1.3rem;
        color: var(--text-color);
        margin: 0.5rem 0 0;
        font-weight: 500;
      }

      .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--card-bg);
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: var(--shadow);
        z-index: 1000;
        width: 90%;
        max-width: 500px;
      }

      .modal.show {
        display: block;
      }

      #profileContent {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }

      #profileContent input {
        padding: 1rem;
        border: 2px solid var(--accent-color);
        border-radius: 12px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      #profileContent input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(76, 175, 144, 0.1);
        outline: none;
      }

      #profileContent button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      #profileContent button:hover {
        background: var(--hover-color);
        transform: translateY(-2px);
      }

      .step {
        width: 90%;
        max-width: 800px;
        margin: 2rem auto;
        background: var(--card-bg);
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: var(--shadow);
      }

      .step h2 {
        color: var(--primary-color);
        font-size: 2rem;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .chatbox {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
        margin-bottom: 2rem;
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: var(--shadow);
      }

      .chatbox label {
        color: var(--text-color);
        font-size: 1.2rem;
        font-weight: 500;
      }

      .chatbox input {
        padding: 1rem;
        border: 2px solid var(--accent-color);
        border-radius: 12px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .chatbox input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(76, 175, 144, 0.1);
        outline: none;
      }

      .chatbox button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .chatbox button:hover {
        background: var(--hover-color);
        transform: translateY(-2px);
      }

      .flowchart {
        width: 100%;
        overflow-x: auto;
        padding: 1rem;
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
      }

      footer {
        text-align: center;
        padding: 2.5rem;
        background: var(--card-bg);
        width: 100%;
        margin-top: auto;
        box-shadow: var(--shadow);
      }

      footer h3 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        font-size: 1.5rem;
      }

      footer a {
        color: var(--accent-color);
        text-decoration: none;
        transition: color 0.3s ease;
        font-weight: 500;
      }

      footer a:hover {
        color: var(--primary-color);
      }

      .connect-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        text-decoration: none;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        z-index: 99;
        font-weight: 600;
      }

      .connect-btn:hover {
        background: var(--hover-color);
        transform: translateY(-2px);
      }

      .ai-assistant {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: var(--primary-color);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        z-index: 99;
        font-weight: 600;
      }

      .ai-assistant:hover {
        background: var(--hover-color);
        transform: translateY(-2px);
      }

      .ai-chat-container {
        position: fixed;
        bottom: 80px;
        left: 20px;
        width: 380px;
        height: 550px;
        background: var(--card-bg);
        border-radius: 20px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        z-index: 1000;
        border: 1px solid rgba(76, 175, 144, 0.1);
      }

      .ai-chat-header {
        background: var(--primary-color);
        color: white;
        padding: 1.2rem;
        border-radius: 20px 20px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
      }

      .ai-chat-messages {
        flex-grow: 1;
        padding: 1.5rem;
        overflow-y: auto;
        background: white;
      }

      .ai-message {
        margin-bottom: 1rem;
        padding: 1rem;
        border-radius: 15px;
        max-width: 85%;
        line-height: 1.5;
      }

      .ai-message.user {
        background: var(--primary-color);
        color: white;
        margin-left: auto;
      }

      .ai-message.assistant {
        background: #F5F5F5;
        color: var(--text-color);
      }

      .ai-chat-input {
        padding: 1.2rem;
        display: flex;
        gap: 0.8rem;
        border-top: 1px solid rgba(76, 175, 144, 0.1);
        background: white;
        border-radius: 0 0 20px 20px;
      }

      .ai-chat-input input {
        flex-grow: 1;
        padding: 0.8rem 1.2rem;
        border: 2px solid var(--accent-color);
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .ai-chat-input input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(76, 175, 144, 0.1);
        outline: none;
      }

      .ai-chat-input button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .ai-chat-input button:hover {
        background: var(--hover-color);
      }

      .quiz-container {
        width: 90%;
        max-width: 800px;
        margin: 2rem auto;
        background: var(--card-bg);
        padding: 2rem;
        border-radius: 15px;
        box-shadow: var(--shadow);
      }

      .quiz-question {
        margin-bottom: 2rem;
      }

      .quiz-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .quiz-option {
        padding: 1rem;
        border: 2px solid var(--accent-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quiz-option:hover {
        background: var(--accent-color);
        color: white;
      }

      .quiz-option.selected {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .quiz-controls {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
      }

      .quiz-controls button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quiz-controls button:hover {
        background: var(--accent-color);
        transform: translateY(-2px);
      }

      .quiz-score {
        text-align: center;
        margin-top: 1rem;
        font-size: 1.2rem;
        color: var(--primary-color);
      }

      .resources {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .resource-link {
        display: inline-flex;
        align-items: center;
        padding: 0.8rem 1.5rem;
        background: var(--primary-color);
        color: white;
        border-radius: 25px;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 1rem;
        font-weight: 500;
        box-shadow: var(--shadow);
      }

      .resource-link:hover {
        background: var(--hover-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(76, 175, 144, 0.2);
      }

      .resource-link i {
        margin-right: 0.5rem;
      }

      .interest-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        border: 1px solid rgba(76, 175, 144, 0.1);
      }

      .interest-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(76, 175, 144, 0.15);
      }

      .interest-card h3 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .interest-card p {
        color: var(--text-color);
        line-height: 1.6;
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
      }

      .loading {
        display: none;
        text-align: center;
        margin: 2rem 0;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--accent-color);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .error-message {
        color: #ff4444;
        margin: 1rem 0;
        padding: 1rem;
        background: #ffeeee;
        border-radius: 8px;
        display: none;
      }

      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 8px 12px;
      }

      .typing-indicator span {
        width: 8px;
        height: 8px;
        background: var(--accent-color);
        border-radius: 50%;
        animation: typing 1s infinite ease-in-out;
      }

      .typing-indicator span:nth-child(1) { animation-delay: 0.2s; }
      .typing-indicator span:nth-child(2) { animation-delay: 0.4s; }
      .typing-indicator span:nth-child(3) { animation-delay: 0.6s; }

      @keyframes typing {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
      }

      .ai-message.typing {
        background: #F5F5F5;
        padding: 8px 12px;
        border-radius: 15px;
        margin-bottom: 1rem;
        max-width: 60px;
      }

      .learning-tracker {
        width: 90%;
        max-width: 800px;
        margin: 2rem auto;
        background: var(--card-bg);
        padding: 2rem;
        border-radius: 20px;
        box-shadow: var(--shadow);
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background: #f0f0f0;
        border-radius: 10px;
        margin: 1rem 0;
        overflow: hidden;
      }

      .progress {
        height: 100%;
        background: var(--primary-color);
        transition: width 0.3s ease;
      }

      .tracker-steps {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .tracker-step {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
      }

      .tracker-step.completed {
        background: #E8F5E9;
      }

      .tracker-step input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-top: 0.2rem;
      }

      .tracker-step label {
        flex-grow: 1;
        font-weight: 500;
        color: var(--text-color);
      }

      .step-notes {
        width: 100%;
        margin-top: 0.5rem;
      }

      .step-notes textarea {
        width: 100%;
        padding: 0.8rem;
        border: 2px solid var(--accent-color);
        border-radius: 8px;
        resize: vertical;
        min-height: 60px;
        font-family: inherit;
      }

      .step-notes textarea:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(76, 175, 144, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="title">
      <h1>CNCT</h1>
      <p>Learn your way - personalised learning</p>
    </div>

    <div id="profileModal" class="modal show">
      <div id="profileContent">
        <input type="text" id="nameInput" placeholder="Enter your name" />
        <input
          type="text"
          id="streamInput"
          placeholder="Enter your stream or focus area"
        />
        <button onclick="saveProfile()">Save</button>
      </div>
    </div>

    <div class="step" id="interestSection" style="display: none;">
      <h2>Your Interests</h2>
      <div class="chatbox">
        <label for="interestsInput">What are you interested in?</label>
        <input
          type="text"
          id="interestsInput"
          placeholder="Type your interests here..."
        />
        <button onclick="generateFlowchart()">Generate Flowchart</button>
      </div>
      <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <p>Generating your personalized learning path...</p>
      </div>
      <div id="errorMessage" class="error-message"></div>
      <div id="flowchartContainer" class="flowchart"></div>
    </div>

    <footer>
      <h3>Contact Us</h3>
      <p>Email: cnctcnc@gmail.com</p>
      <p>Follow us on <a href="#">Instagram</a>, <a href="#">Twitter</a></p>
    </footer>

    <!-- Add AI Assistant Button -->
    <div class="ai-assistant" onclick="toggleAIChat()">
      ðŸ’¬ Ask AI Assistant
    </div>

    <!-- AI Chat Container -->
    <div class="ai-chat-container" id="aiChatContainer" style="display: none;">
      <div class="ai-chat-header">
        <span>AI Learning Assistant</span>
        <button onclick="toggleAIChat()" style="background: none; border: none; color: white; cursor: pointer;">âœ•</button>
      </div>
      <div class="ai-chat-messages" id="aiChatMessages">
        <div class="ai-message assistant">
          Hello! I'm your learning assistant. How can I help you today?
        </div>
      </div>
      <div class="ai-chat-input">
        <input type="text" id="aiChatInput" placeholder="Type your question..." onkeypress="handleAIInput(event)">
        <button onclick="sendAIMessage()">Send</button>
      </div>
    </div>

    <!-- Connect Button -->
    <a href="ok.html" target="_blank" class="connect-btn">Connect with People</a>

    <!-- Quiz Container -->
    <div class="quiz-container" id="quizContainer">
      <h2>Test Your Knowledge</h2>
      <div id="quizContent"></div>
      <div class="quiz-controls">
        <button onclick="previousQuestion()">Previous</button>
        <button onclick="nextQuestion()">Next</button>
      </div>
      <div class="quiz-score" id="quizScore"></div>
    </div>

    <!-- Learning Tracker -->
    <div id="learningTracker"></div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default',
        flowchart: {
          useMaxWidth: false,
          htmlLabels: true,
          curve: 'basis'
        }
      });

      // YouTube API Key - Replace with your own from Google Cloud Console
      const YOUTUBE_API_KEY = 'YOUR_YOUTUBE_API_KEY';

      // Hugging Face API configuration
      const HF_API_URL = "https://api-inference.huggingface.co/models/microsoft/DialoGPT-large";
      const HF_API_KEY = "YOUR_HUGGING_FACE_API_KEY"; // Replace with your API key

      // Learning tracker state
      let learningTracker = {
        currentTopic: '',
        completedSteps: new Set(),
        notes: {},
        progress: 0
      };

      // Initialize learning tracker
      function initLearningTracker(topic) {
        learningTracker.currentTopic = topic;
        learningTracker.completedSteps.clear();
        learningTracker.notes = {};
        learningTracker.progress = 0;
        updateLearningTrackerUI();
      }

      // Update learning tracker UI
      function updateLearningTrackerUI() {
        const trackerContainer = document.getElementById('learningTracker');
        if (!trackerContainer) return;

        const steps = document.querySelectorAll('.interest-card');
        let html = `
          <h3>Learning Progress: ${learningTracker.currentTopic}</h3>
          <div class="progress-bar">
            <div class="progress" style="width: ${learningTracker.progress}%"></div>
          </div>
          <div class="tracker-steps">
        `;

        steps.forEach((step, index) => {
          const stepTitle = step.querySelector('h3').textContent;
          const isCompleted = learningTracker.completedSteps.has(stepTitle);
          html += `
            <div class="tracker-step ${isCompleted ? 'completed' : ''}">
              <input type="checkbox" id="step${index}" 
                ${isCompleted ? 'checked' : ''} 
                onchange="toggleStep('${stepTitle}', this.checked)">
              <label for="step${index}">${stepTitle}</label>
              <div class="step-notes">
                <textarea placeholder="Add notes..." 
                  onchange="updateNotes('${stepTitle}', this.value)">${learningTracker.notes[stepTitle] || ''}</textarea>
              </div>
            </div>
          `;
        });

        html += '</div>';
        trackerContainer.innerHTML = html;
      }

      // Toggle step completion
      function toggleStep(stepTitle, completed) {
        if (completed) {
          learningTracker.completedSteps.add(stepTitle);
        } else {
          learningTracker.completedSteps.delete(stepTitle);
        }
        updateProgress();
        updateLearningTrackerUI();
      }

      // Update notes
      function updateNotes(stepTitle, notes) {
        learningTracker.notes[stepTitle] = notes;
      }

      // Update progress
      function updateProgress() {
        const steps = document.querySelectorAll('.interest-card');
        const totalSteps = steps.length;
        const completedSteps = learningTracker.completedSteps.size;
        learningTracker.progress = (completedSteps / totalSteps) * 100;
      }

      // Remove quiz container and add learning tracker
      document.addEventListener('DOMContentLoaded', function() {
        const quizContainer = document.getElementById('quizContainer');
        if (quizContainer) {
          quizContainer.remove();
        }

        // Add learning tracker container
        const trackerContainer = document.createElement('div');
        trackerContainer.id = 'learningTracker';
        trackerContainer.className = 'learning-tracker';
        document.body.appendChild(trackerContainer);
      });

      // Add styles for learning tracker
      const style = document.createElement('style');
      style.textContent = `
        .learning-tracker {
          width: 90%;
          max-width: 800px;
          margin: 2rem auto;
          background: var(--card-bg);
          padding: 2rem;
          border-radius: 20px;
          box-shadow: var(--shadow);
        }

        .progress-bar {
          width: 100%;
          height: 20px;
          background: #f0f0f0;
          border-radius: 10px;
          margin: 1rem 0;
          overflow: hidden;
        }

        .progress {
          height: 100%;
          background: var(--primary-color);
          transition: width 0.3s ease;
        }

        .tracker-steps {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          margin-top: 1.5rem;
        }

        .tracker-step {
          display: flex;
          align-items: flex-start;
          gap: 1rem;
          padding: 1rem;
          background: white;
          border-radius: 12px;
          box-shadow: var(--shadow);
          transition: all 0.3s ease;
        }

        .tracker-step.completed {
          background: #E8F5E9;
        }

        .tracker-step input[type="checkbox"] {
          width: 20px;
          height: 20px;
          margin-top: 0.2rem;
        }

        .tracker-step label {
          flex-grow: 1;
          font-weight: 500;
          color: var(--text-color);
        }

        .step-notes {
          width: 100%;
          margin-top: 0.5rem;
        }

        .step-notes textarea {
          width: 100%;
          padding: 0.8rem;
          border: 2px solid var(--accent-color);
          border-radius: 8px;
          resize: vertical;
          min-height: 60px;
          font-family: inherit;
        }

        .step-notes textarea:focus {
          border-color: var(--primary-color);
          outline: none;
          box-shadow: 0 0 0 3px rgba(76, 175, 144, 0.1);
        }
      `;
      document.head.appendChild(style);

      // Update generateFlowchart function to initialize learning tracker
      const originalGenerateFlowchart = generateFlowchart;
      generateFlowchart = function() {
        const interestsInput = document.getElementById("interestsInput").value;
        if (interestsInput) {
          initLearningTracker(interestsInput);
        }
        return originalGenerateFlowchart.apply(this, arguments);
      };

      window.onload = () => {
        // Show the profile modal immediately
        const profileModal = document.getElementById("profileModal");
        profileModal.classList.add("show");
        
        // Hide the interest section until profile is saved
        document.getElementById("interestSection").style.display = "none";
      };

      const profileBtn = document.getElementById("profileBtn");
      const profileModal = document.getElementById("profileModal");

      profileBtn.onclick = () => {
        profileModal.classList.add("show");
      };

      function saveProfile() {
        const name = document.getElementById("nameInput").value;
        const stream = document.getElementById("streamInput").value;
        if (name && stream) {
          localStorage.setItem("name", name);
          localStorage.setItem("stream", stream);
          document.getElementById("profileModal").style.display = "none";
          document.getElementById("interestSection").style.display = "block";
        } else {
          alert("Please fill in both name and stream/major fields");
        }
      }

      async function generateFlowchart() {
        const interestsInput = document.getElementById("interestsInput").value;
        const loading = document.getElementById("loading");
        const errorMessage = document.getElementById("errorMessage");
        const flowchartContainer = document.getElementById("flowchartContainer");

        if (!interestsInput) {
          errorMessage.style.display = "block";
          errorMessage.textContent = "Please enter your interests first!";
          return;
        }

        loading.style.display = "block";
        errorMessage.style.display = "none";
        flowchartContainer.innerHTML = "";

        try {
          // First try to get Wikipedia content using the search API
          const searchResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(interestsInput)}+learning+path&format=json&origin=*`);
          const searchData = await searchResponse.json();
          
          if (!searchResponse.ok || !searchData.query.search.length) {
            throw new Error('No Wikipedia content found');
          }


          // Get the first search result
          const pageTitle = searchData.query.search[0].title;
          
          // Now get the full content
          const contentResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=query&prop=extracts&exintro=1&explaintext=1&titles=${encodeURIComponent(pageTitle)}&format=json&origin=*`);
          const contentData = await contentResponse.json();
          
          if (!contentResponse.ok) {
            throw new Error('Failed to fetch Wikipedia content');
          }

          // Extract the content
          const pages = contentData.query.pages;
          const pageId = Object.keys(pages)[0];
          const content = pages[pageId].extract;

          if (!content) {
            throw new Error('No content available');
          }

          // Create a structured learning path
          const learningPath = createLearningPath(interestsInput, content);
          
          // Generate Mermaid flowchart
          let flowchart = 'graph TD\n';
          flowchart += `    Start["${interestsInput} Learning Path"] --> `;

          learningPath.forEach((step, index) => {
            const stepId = `Step${index}`;
            flowchart += `${stepId}["${step.title}"]\n`;
            if (index < learningPath.length - 1) {
              flowchart += `    ${stepId} --> Step${index + 1}\n`;
            }
          });

          flowchartContainer.innerHTML = `<div class="mermaid">${flowchart}</div>`;
          mermaid.init(undefined, document.querySelectorAll('.mermaid'));

          // Add interactive cards
          const interestCards = document.createElement('div');
          interestCards.className = 'interest-cards';
          
          learningPath.forEach((step, index) => {
            const card = document.createElement('div');
            card.className = 'interest-card';
            
            card.innerHTML = `
              <h3>${step.title}</h3>
              <p>${step.description}</p>
              <div class="resources">
                ${step.resources.map(resource => `
                  <a href="${resource.url}" target="_blank" class="resource-link">
                    ${resource.title}
                  </a>
                `).join('')}
              </div>
            `;
            
            interestCards.appendChild(card);
          });

          flowchartContainer.appendChild(interestCards);

          // Add quiz generation after flowchart
          const quizButton = document.createElement('button');
          quizButton.className = 'resource-link';
          quizButton.textContent = 'Take a Quiz';
          quizButton.onclick = () => generateQuiz(interestsInput);
          flowchartContainer.appendChild(quizButton);

        } catch (error) {
          errorMessage.style.display = "block";
          errorMessage.textContent = `Error: ${error.message}. Please try a different search term.`;
          
          // Show fallback content
          const fallbackContent = `
            <div class="interest-card">
              <h3>Alternative Learning Resources</h3>
              <p>Here are some general resources for learning about ${interestsInput}:</p>
              <div class="resources">
                <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(interestsInput)}+tutorial" target="_blank" class="resource-link">
                  YouTube Tutorials
                </a>
                <a href="https://www.coursera.org/search?query=${encodeURIComponent(interestsInput)}" target="_blank" class="resource-link">
                  Coursera Courses
                </a>
                <a href="https://www.udemy.com/courses/search/?q=${encodeURIComponent(interestsInput)}" target="_blank" class="resource-link">
                  Udemy Courses
                </a>
              </div>
            </div>
          `;
          flowchartContainer.innerHTML = fallbackContent;
        } finally {
          loading.style.display = "none";
        }
      }

      function createLearningPath(topic, content) {
        // Split content into sentences
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        
        // Define topic-specific learning paths
        const patterns = {
          'programming': [
            { 
              title: 'Programming Fundamentals',
              keywords: ['basic', 'fundamental', 'syntax', 'variable', 'data type'],
              description: 'Start with programming basics, variables, data types, and control structures'
            },
            { 
              title: 'Core Programming Concepts',
              keywords: ['function', 'object', 'class', 'method', 'algorithm'],
              description: 'Learn about functions, objects, classes, and basic algorithms'
            },
            { 
              title: 'Advanced Programming',
              keywords: ['advanced', 'complex', 'optimization', 'design pattern', 'architecture'],
              description: 'Dive into advanced concepts, design patterns, and software architecture'
            },
            { 
              title: 'Project Development',
              keywords: ['project', 'application', 'development', 'implementation', 'deployment'],
              description: 'Build real-world projects and learn deployment strategies'
            }
          ],
          'data science': [
            {
              title: 'Data Analysis Basics',
              keywords: ['data', 'analysis', 'statistics', 'visualization', 'pandas'],
              description: 'Learn data manipulation, basic statistics, and visualization'
            },
            {
              title: 'Machine Learning Fundamentals',
              keywords: ['machine learning', 'algorithm', 'model', 'training', 'prediction'],
              description: 'Understand machine learning algorithms and model training'
            },
            {
              title: 'Advanced Analytics',
              keywords: ['deep learning', 'neural network', 'big data', 'optimization'],
              description: 'Explore deep learning, neural networks, and big data processing'
            },
            {
              title: 'Real-world Applications',
              keywords: ['application', 'project', 'implementation', 'deployment', 'production'],
              description: 'Apply your skills to real-world data science projects'
            }
          ],
          'web development': [
            {
              title: 'Web Fundamentals',
              keywords: ['html', 'css', 'javascript', 'basic', 'frontend'],
              description: 'Master HTML, CSS, and basic JavaScript for web development'
            },
            {
              title: 'Frontend Development',
              keywords: ['react', 'angular', 'vue', 'framework', 'component'],
              description: 'Learn modern frontend frameworks and component-based development'
            },
            {
              title: 'Backend Development',
              keywords: ['server', 'database', 'api', 'backend', 'node'],
              description: 'Understand server-side programming, databases, and APIs'
            },
            {
              title: 'Full Stack Projects',
              keywords: ['full stack', 'project', 'deployment', 'production', 'application'],
              description: 'Build and deploy complete web applications'
            }
          ],
          'default': [
            {
              title: 'Introduction & Basics',
              keywords: ['introduction', 'basic', 'fundamental', 'overview', 'beginner'],
              description: 'Start with the fundamental concepts and basic principles'
            },
            {
              title: 'Core Concepts',
              keywords: ['core', 'concept', 'principle', 'theory', 'method'],
              description: 'Dive into the core concepts and essential theories'
            },
            {
              title: 'Advanced Topics',
              keywords: ['advanced', 'complex', 'sophisticated', 'expert', 'specialized'],
              description: 'Explore advanced topics and specialized areas'
            },
            {
              title: 'Practical Applications',
              keywords: ['application', 'practice', 'implementation', 'project', 'real-world'],
              description: 'Apply your knowledge to real-world projects and scenarios'
            }
          ]
        };

        // Determine the appropriate pattern based on the topic
        let pattern = patterns.default;
        const topicLower = topic.toLowerCase();
        
        if (topicLower.includes('programming') || topicLower.includes('coding') || topicLower.includes('software')) {
          pattern = patterns.programming;
        } else if (topicLower.includes('data') || topicLower.includes('analytics') || topicLower.includes('machine learning')) {
          pattern = patterns['data science'];
        } else if (topicLower.includes('web') || topicLower.includes('frontend') || topicLower.includes('backend')) {
          pattern = patterns['web development'];
        }

        // Create learning path steps with relevant content
        return pattern.map(step => {
          // Find relevant sentences for this step
          const relevantSentences = sentences.filter(sentence => 
            step.keywords.some(keyword => 
              sentence.toLowerCase().includes(keyword.toLowerCase())
            )
          );

          // Get the most relevant sentence or use the default description
          const description = relevantSentences.length > 0 
            ? relevantSentences[0].trim()
            : step.description;

          return {
            title: step.title,
            description: description,
            resources: generateResources(step.title, topic)
          };
        });
      }

      function generateResources(stepTitle, mainTopic) {
        const resources = [
          {
            title: 'ðŸ“š Learn More',
            url: `https://en.wikipedia.org/wiki/${encodeURIComponent(stepTitle)}`
          },
          {
            title: 'ðŸŽ¥ Video Tutorials',
            url: `https://www.youtube.com/results?search_query=${encodeURIComponent(stepTitle + ' ' + mainTopic)}+tutorial`
          },
          {
            title: 'ðŸŽ“ Online Courses',
            url: `https://www.coursera.org/search?query=${encodeURIComponent(stepTitle + ' ' + mainTopic)}`
          }
        ];

        // Add topic-specific resources
        if (mainTopic.toLowerCase().includes('programming')) {
          resources.push({
            title: 'ðŸ’» Code Examples',
            url: `https://github.com/topics/${encodeURIComponent(stepTitle)}`
          });
        }

        return resources;
      }

      function generateQuiz(topic) {
        // Implementation of generateQuiz function
      }

      function toggleAIChat() {
        const chatContainer = document.getElementById('aiChatContainer');
        chatContainer.style.display = chatContainer.style.display === 'none' ? 'flex' : 'none';
      }

      function handleAIInput(event) {
        if (event.key === 'Enter') {
          sendAIMessage();
        }
      }

      async function sendAIMessage() {
        const input = document.getElementById('aiChatInput');
        const message = input.value.trim();
        
        if (message) {
          const chatMessages = document.getElementById('aiChatMessages');
          
          // Add user message
          const userMessage = document.createElement('div');
          userMessage.className = 'ai-message user';
          userMessage.textContent = message;
          chatMessages.appendChild(userMessage);
          
          // Clear input
          input.value = '';
          
          // Show typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.className = 'ai-message assistant typing';
          typingIndicator.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
          chatMessages.appendChild(typingIndicator);
          
          try {
            // Try to get response from Hugging Face
            const hfResponse = await queryHuggingFace({
              inputs: {
                text: message
              }
            });

            // Remove typing indicator
            chatMessages.removeChild(typingIndicator);

            if (hfResponse && hfResponse.generated_text) {
              // Use Hugging Face response
              const assistantMessage = document.createElement('div');
              assistantMessage.className = 'ai-message assistant';
              assistantMessage.textContent = hfResponse.generated_text;
              chatMessages.appendChild(assistantMessage);
            } else {
              // Fallback to local responses if Hugging Face fails
              const localResponse = generateAIResponse(message);
              const assistantMessage = document.createElement('div');
              assistantMessage.className = 'ai-message assistant';
              assistantMessage.textContent = localResponse;
              chatMessages.appendChild(assistantMessage);
            }
          } catch (error) {
            // Remove typing indicator
            chatMessages.removeChild(typingIndicator);
            
            // Fallback to local responses
            const localResponse = generateAIResponse(message);
            const assistantMessage = document.createElement('div');
            assistantMessage.className = 'ai-message assistant';
            assistantMessage.textContent = localResponse;
            chatMessages.appendChild(assistantMessage);
          }
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      }

      function generateAIResponse(message) {
        const lowerMessage = message.toLowerCase();
        
        // Learning style assessment
        if (lowerMessage.includes('learning style') || lowerMessage.includes('how do i learn')) {
          return "Let me help you understand your learning style! Here are the main types:\n\n" +
                 "1. Visual Learners:\n" +
                 "   - Learn best through images and diagrams\n" +
                 "   - Use mind maps and flowcharts\n" +
                 "   - Watch video tutorials\n\n" +
                 "2. Auditory Learners:\n" +
                 "   - Learn through listening and speaking\n" +
                 "   - Participate in discussions\n" +
                 "   - Record and listen to lectures\n\n" +
                 "3. Reading/Writing Learners:\n" +
                 "   - Learn through text\n" +
                 "   - Take detailed notes\n" +
                 "   - Read and write summaries\n\n" +
                 "4. Kinesthetic Learners:\n" +
                 "   - Learn through hands-on experience\n" +
                 "   - Do practical exercises\n" +
                 "   - Build projects\n\n" +
                 "Would you like to take a quick learning style assessment?";
        }

        // Career path suggestions
        if (lowerMessage.includes('career') || lowerMessage.includes('job') || lowerMessage.includes('future')) {
          return "I can help you explore career paths! Let's consider:\n\n" +
                 "1. Your Interests:\n" +
                 "   - What subjects do you enjoy?\n" +
                 "   - What activities energize you?\n\n" +
                 "2. Your Skills:\n" +
                 "   - Technical abilities\n" +
                 "   - Soft skills\n" +
                 "   - Transferable skills\n\n" +
                 "3. Market Trends:\n" +
                 "   - Growing industries\n" +
                 "   - Future job prospects\n" +
                 "   - Required qualifications\n\n" +
                 "Would you like to explore specific career paths based on your interests?";
        }

        // Study techniques
        if (lowerMessage.includes('study') || lowerMessage.includes('exam') || lowerMessage.includes('test')) {
          return "Here are effective study techniques:\n\n" +
                 "1. Active Recall:\n" +
                 "   - Test yourself regularly\n" +
                 "   - Use flashcards\n" +
                 "   - Explain concepts to others\n\n" +
                 "2. Spaced Repetition:\n" +
                 "   - Review material at increasing intervals\n" +
                 "   - Use apps like Anki\n" +
                 "   - Create a study schedule\n\n" +
                 "3. Mind Mapping:\n" +
                 "   - Create visual connections\n" +
                 "   - Organize information hierarchically\n" +
                 "   - Use colors and images\n\n" +
                 "4. Practice Problems:\n" +
                 "   - Solve sample questions\n" +
                 "   - Create your own problems\n" +
                 "   - Review past exams\n\n" +
                 "Would you like specific techniques for your subject?";
        }

        // Project-based learning
        if (lowerMessage.includes('project') || lowerMessage.includes('build') || lowerMessage.includes('create')) {
          return "Let's plan your learning project:\n\n" +
                 "1. Project Selection:\n" +
                 "   - Choose something challenging but achievable\n" +
                 "   - Align with your learning goals\n" +
                 "   - Consider real-world applications\n\n" +
                 "2. Planning Phase:\n" +
                 "   - Break down into smaller tasks\n" +
                 "   - Set milestones and deadlines\n" +
                 "   - Identify required resources\n\n" +
                 "3. Implementation:\n" +
                 "   - Start with a prototype\n" +
                 "   - Document your progress\n" +
                 "   - Seek feedback regularly\n\n" +
                 "4. Reflection:\n" +
                 "   - What did you learn?\n" +
                 "   - What could be improved?\n" +
                 "   - How to apply this knowledge?\n\n" +
                 "Would you like help choosing or planning a specific project?";
        }

        // Learning path creation
        if (lowerMessage.includes('learning path') || lowerMessage.includes('roadmap') || lowerMessage.includes('plan')) {
          return "I'll help you create a personalized learning path! Let's consider:\n\n" +
                 "1. Current Level:\n" +
                 "   - What do you already know?\n" +
                 "   - What are your strengths?\n" +
                 "   - What areas need improvement?\n\n" +
                 "2. Goals:\n" +
                 "   - Short-term objectives\n" +
                 "   - Long-term aspirations\n" +
                 "   - Specific skills to acquire\n\n" +
                 "3. Resources:\n" +
                 "   - Online courses\n" +
                 "   - Books and articles\n" +
                 "   - Practice exercises\n" +
                 "   - Community support\n\n" +
                 "4. Timeline:\n" +
                 "   - Weekly milestones\n" +
                 "   - Monthly goals\n" +
                 "   - Regular assessments\n\n" +
                 "Would you like to create a detailed learning path for a specific topic?";
        }

        // Progress tracking
        if (lowerMessage.includes('progress') || lowerMessage.includes('track') || lowerMessage.includes('improve')) {
          return "Let's track your learning progress:\n\n" +
                 "1. Assessment Methods:\n" +
                 "   - Regular quizzes\n" +
                 "   - Project milestones\n" +
                 "   - Skill demonstrations\n" +
                 "   - Peer reviews\n\n" +
                 "2. Progress Metrics:\n" +
                 "   - Knowledge retention\n" +
                 "   - Skill proficiency\n" +
                 "   - Problem-solving ability\n" +
                 "   - Project completion\n\n" +
                 "3. Improvement Strategies:\n" +
                 "   - Identify weak areas\n" +
                 "   - Adjust learning methods\n" +
                 "   - Seek additional resources\n" +
                 "   - Practice consistently\n\n" +
                 "Would you like to set up a progress tracking system?";
        }

        // Default response with learning assistance
        return "I'm your AI learning assistant! I can help you with:\n\n" +
               "1. Personalized Learning Paths\n" +
               "   - Customized study plans\n" +
               "   - Resource recommendations\n" +
               "   - Progress tracking\n\n" +
               "2. Study Techniques\n" +
               "   - Effective learning methods\n" +
               "   - Time management\n" +
               "   - Exam preparation\n\n" +
               "3. Career Guidance\n" +
               "   - Career path exploration\n" +
               "   - Skill development\n" +
               "   - Industry trends\n\n" +
               "4. Project Support\n" +
               "   - Project planning\n" +
               "   - Implementation guidance\n" +
               "   - Problem-solving\n\n" +
               "What would you like to explore?";
      }

      function previousQuestion() {
        // Implementation of previousQuestion function
      }

      function nextQuestion() {
        // Implementation of nextQuestion function
      }
    </script>
  </body>
</html>