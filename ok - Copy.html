<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CNCT - Personalized Learning</title>
    <style>
      :root {
        --primary-color: #ff6f00;
        --accent-color: #ff8f00;
        --text-color: #222;
        --bg-gradient: linear-gradient(135deg, #fdfbfb, #ebedee);
        --modal-bg: #fff;
        --console-bg: #1e1e2f;
        --console-text: #e0e0e0;
        --btn-hover: #ffa040;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", sans-serif;
      }

      body {
        background: var(--bg-gradient);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px 20px;
        min-height: 100vh;
      }

      header {
        width: 100%;
        max-width: 900px;
        display: flex;
        justify-content: flex-end;
        padding: 10px 0;
      }

      #profileBtn {
        background: var(--primary-color);
        color: #fff;
        padding: 12px 24px;
        font-size: 1rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
      }

      #profileBtn:hover {
        background: var(--btn-hover);
      }

      .title {
        text-align: center;
        margin: 40px 0 20px;
      }

      .title h1 {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .title p {
        font-size: 1.3rem;
        font-style: italic;
      }

      .modal {
        display: none;
        position: fixed;
        top: 100px;
        right: 40px;
        background: var(--modal-bg);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        width: 300px;
        animation: fadeIn 0.4s ease-out;
      }

      .modal.show {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal input {
        margin: 8px 0;
        padding: 10px;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 6px;
      }

      .modal button {
        background: var(--primary-color);
        color: #fff;
        border: none;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 10px;
        width: 100%;
        transition: background 0.3s;
      }

      .modal button:hover {
        background: var(--btn-hover);
      }

      .step {
        width: 100%;
        max-width: 900px;
        margin-top: 40px;
        display: none;
      }

      .chatbox {
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #ddd;
      }

      .chatbox input {
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 100%;
      }

      .chatbox button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .chatbox button:hover {
        background: var(--btn-hover);
      }

      .flowchart {
        margin-top: 20px;
        padding: 20px;
        background: var(--console-bg);
        color: var(--console-text);
        font-family: "Courier New", monospace;
        border-radius: 12px;
        min-height: 150px;
        white-space: pre-wrap;
        border: 1px solid #444;
      }

      footer {
        margin-top: 60px;
        padding: 20px;
        width: 100%;
        background: var(--primary-color);
        color: white;
        border-radius: 10px;
        max-width: 900px;
        text-align: center;
      }

      a {
        color: white;
        text-decoration: underline;
      }

      .connect-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(45deg, #6a11cb, #2575fc);
        color: white;
        padding: 14px 24px;
        border-radius: 12px;
        font-weight: bold;
        font-size: 1rem;
        box-shadow: 0 0 12px rgba(106, 17, 203, 0.6),
          0 0 18px rgba(37, 117, 252, 0.6);
        transition: all 0.3s ease;
        z-index: 999;
        text-decoration: none;
      }

      .connect-btn:hover {
        background: #fff;
        color: #2575fc;
        border: 2px solid #2575fc;
      }

      .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .interest-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
      }

      .interest-card:hover {
        transform: translateY(-5px);
      }

      .resource-link {
        display: inline-block;
        margin: 5px;
        padding: 8px 15px;
        background: var(--primary-color);
        color: white;
        border-radius: 5px;
        text-decoration: none;
        transition: background 0.3s;
      }

      .resource-link:hover {
        background: var(--btn-hover);
      }

      .error-message {
        color: #ff4444;
        margin: 10px 0;
        padding: 10px;
        background: #ffeeee;
        border-radius: 5px;
        display: none;
      }
    </style>
  </head>
  <body>
    <a href="ok.html" target="_blank" class="connect-btn"
      >Connect with People with same</a
    >

    <header>
      <button id="profileBtn">ðŸ‘¤ Profile</button>
    </header>

    <div class="title">
      <h1>CNCT</h1>
      <p>Learn your way - personalised learning</p>
    </div>

    <div id="profileModal" class="modal">
      <div id="profileContent">
        <input type="text" id="nameInput" placeholder="Enter your name" />
        <input
          type="text"
          id="streamInput"
          placeholder="Enter your stream or focus area"
        />
        <button onclick="saveProfile()">Save</button>
      </div>
    </div>

    <div class="step" id="interestSection">
      <h2>Your Interests</h2>
      <div class="chatbox">
        <label for="interestsInput">What are you interested in?</label>
        <input
          type="text"
          id="interestsInput"
          placeholder="Type your interests here..."
        />
        <button onclick="generateFlowchart()">Generate Flowchart</button>
      </div>
      <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <p>Generating your personalized learning path...</p>
      </div>
      <div id="errorMessage" class="error-message"></div>
      <div id="flowchartContainer" class="flowchart"></div>
    </div>

    <footer>
      <h3>Contact Us</h3>
      <p>Email: cnctcnc@gmail.com</p>
      <p>Follow us on <a href="#">Instagram</a>, <a href="#">Twitter</a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default',
        flowchart: {
          useMaxWidth: false,
          htmlLabels: true,
          curve: 'basis'
        }
      });

      // YouTube API Key - Replace with your own from Google Cloud Console
      const YOUTUBE_API_KEY = 'YOUR_YOUTUBE_API_KEY';

      window.onload = () => {
        localStorage.clear();
        document.getElementById("profileModal").classList.add("show");
      };

      const profileBtn = document.getElementById("profileBtn");
      const profileModal = document.getElementById("profileModal");

      profileBtn.onclick = () => {
        profileModal.classList.add("show");
      };

      function saveProfile() {
        const name = document.getElementById("nameInput").value;
        const stream = document.getElementById("streamInput").value;
        if (name && stream) {
          localStorage.setItem("name", name);
          localStorage.setItem("stream", stream);
          profileModal.classList.remove("show");
          document.getElementById("interestSection").style.display = "block";
        }
      }

      async function generateFlowchart() {
        const interestsInput = document.getElementById("interestsInput").value;
        const loading = document.getElementById("loading");
        const errorMessage = document.getElementById("errorMessage");
        const flowchartContainer = document.getElementById("flowchartContainer");

        if (!interestsInput) {
          errorMessage.style.display = "block";
          errorMessage.textContent = "Please enter your interests first!";
          return;
        }

        loading.style.display = "block";
        errorMessage.style.display = "none";
        flowchartContainer.innerHTML = "";

        try {
          // First try to get Wikipedia content using the search API
          const searchResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(interestsInput)}&format=json&origin=*`);
          const searchData = await searchResponse.json();
          
          if (!searchResponse.ok || !searchData.query.search.length) {
            throw new Error('No Wikipedia content found');
          }

          // Get the first search result
          const pageTitle = searchData.query.search[0].title;
          
          // Now get the full content
          const contentResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=query&prop=extracts&exintro=1&explaintext=1&titles=${encodeURIComponent(pageTitle)}&format=json&origin=*`);
          const contentData = await contentResponse.json();
          
          if (!contentResponse.ok) {
            throw new Error('Failed to fetch Wikipedia content');
          }

          // Extract the content
          const pages = contentData.query.pages;
          const pageId = Object.keys(pages)[0];
          const content = pages[pageId].extract;

          if (!content) {
            throw new Error('No content available');
          }

          // Extract main topics from content
          const topics = extractTopics(content);
          
          // Generate Mermaid flowchart
          let flowchart = 'graph TD\n';
          flowchart += `    Start["${interestsInput}"] --> `;

          topics.forEach((topic, index) => {
            const topicId = `Topic${index}`;
            flowchart += `${topicId}["${topic}"]\n`;
            if (index < topics.length - 1) {
              flowchart += `    ${topicId} --> Topic${index + 1}\n`;
            }
          });

          flowchartContainer.innerHTML = `<div class="mermaid">${flowchart}</div>`;
          mermaid.init(undefined, document.querySelectorAll('.mermaid'));

          // Add interactive cards
          const interestCards = document.createElement('div');
          interestCards.className = 'interest-cards';
          
          for (const topic of topics) {
            const card = document.createElement('div');
            card.className = 'interest-card';
            
            // Get related content
            const description = getTopicDescription(content, topic);
            const relatedTopics = getRelatedTopics(content, topic);
            
            card.innerHTML = `
              <h3>${topic}</h3>
              <p>${description}</p>
              ${relatedTopics.length > 0 ? `
                <div class="related-topics">
                  <h4>Related Topics:</h4>
                  <ul>
                    ${relatedTopics.map(rt => `<li>${rt}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
              <div class="resources">
                <a href="https://en.wikipedia.org/wiki/${encodeURIComponent(pageTitle)}" target="_blank" class="resource-link">
                  Read More on Wikipedia
                </a>
                <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(topic)}+tutorial" target="_blank" class="resource-link">
                  Find Tutorials on YouTube
                </a>
                <a href="https://www.google.com/search?q=${encodeURIComponent(topic)}+learning+resources" target="_blank" class="resource-link">
                  Search Learning Resources
                </a>
              </div>
            `;
            interestCards.appendChild(card);
          }

          flowchartContainer.appendChild(interestCards);

        } catch (error) {
          errorMessage.style.display = "block";
          errorMessage.textContent = `Error: ${error.message}. Please try a different search term.`;
          
          // Show fallback content
          const fallbackContent = `
            <div class="interest-card">
              <h3>Alternative Learning Resources</h3>
              <p>Here are some general resources for learning about ${interestsInput}:</p>
              <div class="resources">
                <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(interestsInput)}+tutorial" target="_blank" class="resource-link">
                  YouTube Tutorials
                </a>
                <a href="https://www.coursera.org/search?query=${encodeURIComponent(interestsInput)}" target="_blank" class="resource-link">
                  Coursera Courses
                </a>
                <a href="https://www.udemy.com/courses/search/?q=${encodeURIComponent(interestsInput)}" target="_blank" class="resource-link">
                  Udemy Courses
                </a>
                <a href="https://www.google.com/search?q=${encodeURIComponent(interestsInput)}+learning+resources" target="_blank" class="resource-link">
                  Google Search
                </a>
              </div>
            </div>
          `;
          flowchartContainer.innerHTML = fallbackContent;
        } finally {
          loading.style.display = "none";
        }
      }

      function extractTopics(content) {
        // Split content into sentences and extract main topics
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        return sentences.slice(0, 5).map(sentence => {
          // Extract the main topic from each sentence
          const words = sentence.split(' ');
          return words.slice(0, 5).join(' ').trim();
        });
      }

      function getTopicDescription(content, topic) {
        // Find the sentence containing the topic
        const sentences = content.split(/[.!?]+/);
        const relevantSentence = sentences.find(s => s.includes(topic));
        return relevantSentence ? relevantSentence.trim() : topic;
      }

      function getRelatedTopics(content, topic) {
        // Find sentences that might contain related topics
        const sentences = content.split(/[.!?]+/);
        const relatedSentences = sentences.filter(s => 
          s.includes(topic) && s.length > 20 && s.length < 200
        );
        
        // Extract potential related topics
        return relatedSentences.slice(0, 3).map(sentence => {
          const words = sentence.split(' ');
          return words.slice(0, 8).join(' ').trim();
        });
      }

      async function searchYouTubeVideos(topic) {
        try {
          const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(topic)}&type=video&maxResults=3&key=${YOUTUBE_API_KEY}`);
          const data = await response.json();
          
          if (!response.ok) {
            throw new Error('Failed to fetch YouTube videos');
          }

          return data.items.map(item => ({
            title: item.snippet.title,
            url: `https://www.youtube.com/watch?v=${item.id.videoId}`
          }));
        } catch (error) {
          console.error('Error fetching YouTube videos:', error);
          return [];
        }
      }
    </script>
  </body>
</html>
